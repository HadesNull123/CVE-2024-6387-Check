#!/bin/bash

vulnerable_versions=(
    'OpenSSH_8.5p1'
    'OpenSSH_8.6p1'
    'OpenSSH_8.7p1'
    'OpenSSH_8.8p1'
    'OpenSSH_8.9p1'
    'OpenSSH_9.0p1'
    'OpenSSH_9.1p1'
    'OpenSSH_9.2p1'
    'OpenSSH_9.3p1'
    'OpenSSH_9.4p1'
    'OpenSSH_9.5p1'
    'OpenSSH_9.6p1'
    'OpenSSH_9.7p1'
)

check_ssh() {
    version_ssh=$(ssh -V 2>&1)
    echo "$version_ssh"
}

find_compare() {
    local version_ssh="$1"

    if [[ -z "$version_ssh" ]]; then
        echo "Check SSH version failed."
        return 1
    fi

    hostname=$(hostname)

    for version in "${vulnerable_versions[@]}"; do
        if [[ "$version_ssh" == *"$version"* ]]; then
            echo -e "Hostname: $hostname\nSSH version $version is vulnerable."
            return 0
        fi
    done
    echo -e "Hostname: $hostname\nSSH version $version_ssh is not vulnerable."
    return 1
}

main() {
    version_ssh=$(check_ssh)
    find_compare "$version_ssh"
}

main
